<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Therapist - Your Sanctuary</title>
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/home.js" defer></script>
    <script>
        // Fallback if app.js fails to load
        window.addEventListener('error', (e) => {
            if (e.target.src && e.target.src.includes('app.js')) {
                console.log('Failed to load app.js. Ensure it is served at /app.js with Content-Type: application/javascript');
            }
        }, true);
    </script>
</head>

<body class="light-mode">
    <div class="home-container">
        <!-- Greeting Header -->
        <header class="greeting-header">
            <h1 id="greeting">Welcome back, Guest!</h1>
            <div class="mood-selector">
                <p>How are you feeling today?</p>
                <div class="emoji-buttons">
                    <button data-mood="happy">üòä</button>
                    <button data-mood="neutral">üòê</button>
                    <button data-mood="sad">üòî</button>
                    <button data-mood="stressed">üòì</button>
                </div>
                <p id="affirmation" class="affirmation"></p>
                <button class="action-btn" onclick="playClickSound && playClickSound(); generateAffirmation()">New
                    Affirmation</button>
            </div>
            <p class="quote">"Small steps lead to big changes."</p>
        </header>

        <!-- Quick Actions -->
        <section class="quick-actions">
            <button class="action-btn" data-feature="journal">Journal Now</button>
            <button class="action-btn" data-feature="ai">Talk to Therapist</button>
            <button class="action-btn" data-feature="tracker">Track Habit/Mood</button>
            <button class="action-btn" data-feature="leader">leader board</button>
            <button class="action-btn" data-feature="fai">Talk to a Friend</button>
        </section>

        <!-- User Profile Snapshot -->
        <section class="profile-snapshot card">
            <canvas id="avatar" width="50" height="50" class="avatar"></canvas>
            <div class="profile-info">
                <h3 id="profile-name">Guest</h3>
                <p>Streak: <span id="streak">3 days</span> | Mood: <span id="current-mood">Not set</span></p>
                <div class="progress-bar">
                    <div class="progress" style="width: 71%"></div>
                </div>
                <p>This week: 5/7 productive days</p>
            </div>
        </section>

        <!-- Streak Motivator -->
        <section class="streak-motivator card">
            <h2>Your Streak</h2>
            <p>Current Streak: <span id="streak-display">3 days</span></p>
            <p id="streak-message">Keep it up! You're building consistency.</p>
            <p>Streak History: <span id="streak-history">3, 2, 1 days</span></p>
        </section>

        <!-- Daily Focus -->
        <section class="daily-focus card">
            <h2>Today's Focus</h2>
            <ul class="task-list" id="task-list">
                <li><input type="checkbox" id="task1" data-task="Walk 30 mins"> <label for="task1">Walk 30 mins</label>
                </li>
                <li><input type="checkbox" id="task2" data-task="No social media for 2 hrs"> <label for="task2">No
                        social media for 2 hrs</label></li>
                <li><input type="checkbox" id="task3" data-task="Study 6 hrs"> <label for="task3">Study 6 hrs</label>
                </li>
            </ul>
            <button class="action-btn" onclick="playClickSound && playClickSound(); openTaskModal()">Add Task</button>
        </section>

        <!-- Emotional Tracker Graph -->
        <section class="emotional-tracker card">
            <h2>Your Mood Over Time</h2>
            <canvas id="moodChart" height="100"></canvas>
        </section>

        <!-- Therapist Chat Preview -->
        <section class="therapist-chat card clickable" data-feature="ai">
            <h2>Therapist Chat</h2>
            <p><strong>You:</strong> I've been feeling stressed lately...</p>
            <p><strong>Therapist:</strong> Let's explore what's been going on.</p>
            <button class="action-btn">Continue Conversation</button>
        </section>

        <!-- Talk to a Friend -->
        <section class="friend-chat card clickable" data-feature="f-ai">
            <h2>Talk to a Friend</h2>
            <p>Feeling lonely? Connect with someone who understands.</p>
            <button class="action-btn">Start a Conversation</button>
        </section>

        <!-- Growth Hub -->
        <section class="growth-hub card">
            <h2>Your Growth Hub</h2>
            <div class="habit-list" id="habit-list">
                <p data-habit="Meditation">Meditation: 4/7 this week ‚úÖ <button class="action-btn small-btn"
                        onclick="playCompleteSound && playCompleteSound(); completeHabit('Meditation')">Complete
                        Today</button></p>
                <p data-habit="Waking up early">Waking up early: 6/7 this week ‚úÖ <button class="action-btn small-btn"
                        onclick="playCompleteSound && playCompleteSound(); completeHabit('Waking up early')">Complete
                        Today</button></p>
            </div>
            <button class="action-btn" onclick="playClickSound && playClickSound(); openHabitModal()">Add New
                Habit</button>
        </section>

        <!-- Distraction Tracker -->
        <section class="distraction-tracker card">
            <h2>Distraction Tracker</h2>
            <p>Distractions avoided today: <span id="distractions">2</span></p>
            <select id="trigger">
                <option value="">Log a trigger</option>
                <option value="Stress">Stress</option>
                <option value="Boredom">Boredom</option>
                <option value="Other">Other</option>
            </select>
            <div id="trigger-log">
                <p>Recent triggers: None</p>
            </div>
            <button class="action-btn" onclick="playClickSound && playClickSound(); doBreathingExercise()">Do Breathing
                Exercise</button>
        </section>

        <!-- Gratitude Log -->
        <section class="gratitude-log card">
            <h2>Gratitude Log</h2>
            <textarea id="gratitude" placeholder="What are you grateful for today?"></textarea>
        </section>

        <!-- Mood Reflection -->
        <section class="mood-reflection card">
            <h2>Mood Reflection</h2>
            <textarea id="mood-reflection" placeholder="Why do you feel this way today?"></textarea>
        </section>

        <!-- Mindfulness Exercise -->
        <section class="mindfulness card">
            <h2>Mindfulness Moment</h2>
            <button class="action-btn" onclick="playClickSound && playClickSound(); startMindfulness()">Start Guided
                Meditation</button>
        </section>

        <!-- Goal Reminder -->
        <section class="goal-reminder card">
            <h2>Your Goal</h2>
            <p id="user-goal">Overcome procrastination and build discipline.</p>
            <button class="action-btn" onclick="playClickSound && playClickSound(); editGoal()">Edit Goal</button>
        </section>

        <!-- Learning Center -->
        <section class="learning-center card clickable" data-feature="learn">
            <h2>Today's Insight</h2>
            <p>How dopamine hijacks habits</p>
            <button class="action-btn">Learn More</button>
        </section>

        <!-- Progress Milestones -->
        <section class="milestones card">
            <h2>Your Milestones</h2>
            <div id="milestone-list">
                <p>Reached 3-day streak! üéâ</p>
            </div>
        </section>

        <!-- Daily Reminder -->
        <section class="daily-reminder card">
            <h2>Daily Reminder</h2>
            <p id="daily-reminder">Reflect and unwind.</p>
        </section>

        <!-- Ambient Playlist -->
        <!-- In home.html, Ambient Playlist section -->
        <section class="distraction-tracker card">
            <h2>Ambient Playlist</h2>
            <select id="ambientSound">
                <option value="none">None</option>
            </select>
            <button class="action-btn" onclick="playClickSound && playClickSound(); toggleMusic()">Play/Stop</button>
            <progress id="music-progress" value="0" max="100"></progress>
            <div id="music-player" style="display: none;"></div> <!-- Replace <iframe> with <div> -->
        </section>
        <!-- Quick Tip -->
        <section class="quick-tip card">
            <h2>Quick Tip</h2>
            <p id="quick-tip">Take 5 deep breaths to reset.</p>
            <button class="action-btn" onclick="playClickSound && playClickSound(); generateTip()">New Tip</button>
        </section>

        <!-- Celebration Canvas -->
        <canvas id="celebration" style="position: fixed; top: 0; left: 0; pointer-events: none;"></canvas>

        <!-- Task Modal -->
        <div class="task-modal" id="taskModal">
            <div class="task-content">
                <h2>Add Task</h2>
                <input type="text" id="newTask" placeholder="Enter task name">
                <button class="action-btn" onclick="playClickSound && playClickSound(); addTask()">Add</button>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeTaskModal()">Close</button>
            </div>
        </div>

        <!-- Habit Modal -->
        <div class="habit-modal" id="habitModal">
            <div class="habit-content">
                <h2>Add Habit</h2>
                <input type="text" id="newHabit" placeholder="Enter habit name">
                <input type="number" id="habitGoal" placeholder="Weekly goal (days)" min="1" max="7">
                <button class="action-btn" onclick="playClickSound && playClickSound(); addHabit()">Add</button>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeHabitModal()">Close</button>
            </div>
        </div>

        <!-- Quick Journal Modal -->
        <div class="journal-modal" id="journalModal">
            <div class="journal-content">
                <h2>Quick Journal Entry</h2>
                <textarea id="quickJournal" placeholder="Write your thoughts..."></textarea>
                <button class="action-btn" onclick="playClickSound && playClickSound(); saveJournal()">Save &
                    Continue</button>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeJournal()">Close</button>
            </div>
        </div>

        <!-- Breathing Exercise Modal -->
        <div class="breathing-modal" id="breathingModal">
            <div class="breathing-content">
                <h2>Guided Breathing</h2>
                <div class="breathing-circle"></div>
                <p id="breathing-text">Breathe in...</p>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeBreathing()">Close</button>
            </div>
        </div>

        <!-- Mindfulness Modal -->
        <div class="mindfulness-modal" id="mindfulnessModal">
            <div class="mindfulness-content">
                <h2>Guided Meditation</h2>
                <p id="meditation-text">Close your eyes, focus on your breath. Let thoughts pass like clouds...</p>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeMindfulness()">Close</button>
            </div>
        </div>

        <!-- Settings Popup -->
        <div class="settings-popup" id="settingsPopup">
            <div class="settings-content">
                <h2>Settings</h2>
                <div class="setting-item">
                    <label for="darkMode">Dark Mode</label>
                    <input type="checkbox" id="darkMode">
                </div>
                <div class="setting-item">
                    <label for="notifications">Daily Reminders</label>
                    <select id="notifications">
                        <option value="off">Off</option>
                        <option value="morning">Morning</option>
                        <option value="evening">Evening</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="ambientSound">Ambient Sound</label>
                    <select id="ambientSound">
                        <option value="none">None</option>
                    </select>
                </div>
                <button class="action-btn" onclick="playClickSound && playClickSound(); exportData()">Export
                    Data</button>
                <button class="action-btn close-btn"
                    onclick="playClickSound && playClickSound(); closeSettings()">Close</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <a onclick="lk1()" class="nav-icon" data-feature="ai"><i class="fa-solid fa-heart"></i></a>
        <a onclick="lk2()" class="nav-icon" data-feature="journal">üìò</a>
        <a onclick="lk3()" class="nav-icon" data-feature="tracker"><i class="fa-solid fa-list-check"></i>
        </a>
        <a onclick="lk4()" class="nav-icon" data-feature="timetable"><i class="fa-solid fa-comments"></i>
        </a>
        <a href="#" class="nav-icon" data-feature="settings">‚öôÔ∏è</a>
    </nav>

    <script>
        function lk1() {
            window.location.href = `/home/ai/${encodeURIComponent(localStorage.getItem('name'))}`
        }
        function lk2() {
            window.location.href = `/home/journal/${encodeURIComponent(localStorage.getItem('name'))}`
        } function lk3() {
            window.location.href = `/home/tracker/${encodeURIComponent(localStorage.getItem('name'))}`
        } function lk4() {
            window.location.href = `/home/fai/${encodeURIComponent(localStorage.getItem('name'))}`
        }

    </script>
</body>

</html>